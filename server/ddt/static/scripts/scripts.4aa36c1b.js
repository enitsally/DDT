"use strict";angular.module("ddtApp",["ui.router","ngMaterial","angularFileUpload","ngIdle","angularSpinner"]).config(["usSpinnerConfigProvider",function(a){a.setDefaults({radius:30,width:8,length:16})}]).config(["KeepaliveProvider","IdleProvider",function(a,b){b.idle(1800),b.timeout(5),a.interval(10)}]).factory("IdleService",["Idle","Keepalive",function(a,b){var c={};return c.started=!1,c.start=function(){a.watch(),c.started=!0},c.stop=function(){a.unwatch(),c.started=!1},c}]).config(["$urlRouterProvider",function(a){a.otherwise("/login")}]).config(["$stateProvider",function(a){a.state("login",{url:"/login",templateUrl:"views/login.html",controller:"loginCtrl",controllerAs:"login"}).state("query_builder",{url:"/query_builder",templateUrl:"views/query_builder.html",controller:"queryBuilderCtrl",controllerAs:"queryBuilder"}).state("query_status",{url:"/query_status",templateUrl:"views/query_status.html",controller:"queryStatusCtrl",controllerAs:"queryStatus"}).state("user_profile",{url:"/user_profile",templateUrl:"views/user_profile.html",controller:"userProfileCtrl",controllerAs:"userProfile"}).state("pattern_builder",{url:"/pattern_builder",templateUrl:"views/pattern_builder.html",controller:"patternBuilderCtrl",controllerAs:"patternBuilder"}).state("metadata_importing",{url:"/metadata_importing",templateUrl:"views/metadata_importing.html",controller:"metadataImportingCtrl",controllerAs:"metadataImporting"}).state("dataset_importing",{url:"/dataset_importing",templateUrl:"views/dataset_importing.html",controller:"datasetImportingCtrl",controllerAs:"datasetImporting"}).state("help",{url:"/help",templateUrl:"views/help.html",controller:"helpCtrl",controllerAs:"help"})}]).controller("ApplicationController",["$rootScope","$scope","$mdSidenav","$mdToast","$http","$state",function(a,b,c,d,e,f){function g(a){return h(function(){c(a).toggle().then(function(){$log.debug("toggle "+a+" is done")})},200)}function h(a,c,d){var e;return function(){var d=b,f=Array.prototype.slice.call(arguments);$timeout.cancel(e),e=$timeout(function(){e=void 0,a.apply(d,f)},c||10)}}a.currentUser=null,b.toggleSidenav=function(a){c(a).toggle()},b.toggleLeft=g("left"),b.isOpenLeft=function(){return c("left").isOpen()},b.close=function(){c("left").close().then(function(){})},b.setCurrentUser=function(b){a.currentUser=b},b.doDirectPage=function(a){"Query Builder"===a?(f.go("query_builder"),c("left").close()):"Query Status"===a?(f.go("query_status"),c("left").close()):"User Profile"===a?(f.go("user_profile"),c("left").close()):"Pattern Builder"===a?(f.go("pattern_builder"),c("left").close()):"Meta-data Importing"===a?(f.go("metadata_importing"),c("left").close()):"Dataset Importing"===a&&(f.go("dataset_importing"),c("left").close())},b.menu=[{link:"",title:"Query Builder",icon:"images/icon/getfile.3923b3ed.svg"},{link:"",title:"Query Status",icon:"images/icon/settings.c8e39598.svg"},{link:"",title:"User Profile",icon:"images/icon/settings.c8e39598.svg"}],b.admin=[{link:"",title:"Pattern Builder",icon:"images/icon/settings.c8e39598.svg"},{link:"",title:"Meta-data Importing",icon:"images/icon/settings.c8e39598.svg"},{link:"",title:"Dataset Importing",icon:"images/icon/settings.c8e39598.svg"}],b.doGetHelp=function(){f.go("help")},b.doLogout=function(){e.get("http://localhost:5000/logout").then(function(a){b.showSimpleToast(a.data.status)}),a.currentUser=null,f.go("login"),IdleService.stop()},b.doDirectLogin=function(){a.currentUser=null,f.go("login")}}]).controller("LeftCtrl",["$scope","$timeout","$mdSidenav","$log",function(a,b,c,d){a.close=function(){c("left").close().then(function(){d.debug("close LEFT is done")})}}]).run(["$rootScope","$location","$state","$mdDialog",function(a,b,c,d){a.$on("$stateChangeStart",function(b,d,e,f,g){var h="login"===d.name;h||null===a.currentUser&&(b.preventDefault(),c.go("login"))}),a.$on("IdleTimeout",function(){var a=d.alert().parent(angular.element(document.querySelector("#popupContainer"))).clickOutsideToClose(!0).title("Time out, Session Expired!.").ok("Got it!");d.show(a),c.go("login")})}]),angular.module("ddtApp").controller("loginCtrl",["$scope","$rootScope","$http","$state","$mdToast","AUTH_EVENTS","AuthService","IdleService",function(a,b,c,d,e,f,g,h){a.credentials={username:"",password:""},a.showSimpleToast=function(a){e.show(e.simple().content(a).position("bottom right").hideDelay(1e3))},a.doLogin=function(c){g.login(c).then(function(c){b.$broadcast(f.loginSuccess),a.setCurrentUser(c),"User"===c.role?(d.go("query_builder"),a.message=c.id+", You are logged in.",h.start()):"Admin"===c.role?(d.go("pattern_builder"),a.message=c.id+", Admin, You are logged in.",h.start()):(a.message="Login failed, please try again.",a.setCurrentUser(null),b.$broadcast(f.loginFailed)),a.showSimpleToast(a.message)},function(){a.setCurrentUser(null),b.$broadcast(f.loginFailed)})}}]).factory("AuthService",["$http",function(a){var b={};return b.login=function(b){return a.post("/login",b).then(function(a){return a.data.user})},b}]).constant("AUTH_EVENTS",{loginSuccess:"auth-login-success",loginFailed:"auth-login-failed",logoutSuccess:"auth-logout-success",sessionTimeout:"auth-session-timeout",notAuthenticated:"auth-not-authenticated",notAuthorized:"auth-not-authorized"}).constant("USER_ROLES",{all:"*",A:"admin",U:"user"}),angular.module("ddtApp").controller("queryBuilderCtrl",["$log","$q","$scope","$rootScope","$mdDialog","$http","$state","$mdToast","$mdMedia","AUTH_EVENTS","AuthService","FileUploader","IdleService",function(a,b,c,d,e,f,g,h,i,j,k,l,m){function n(a,b,c){a.save_result=c,a.hide=function(){b.hide()},a.cancel=function(){b.cancel()},a.answer=function(a){b.hide(a)}}function o(a){var b=angular.uppercase(a);return function(a){return 0===a.conn_key.indexOf(b)}}function p(a){var b=angular.uppercase(a);return function(a){return 0===a.pattern_descr.indexOf(b)}}c.customFullscreen=!1,c.selectedConnKey=[],c.searchText="",c.searchText_new="",c.searchText_descr="",c.showPopover=!1,c.query_user=c.currentUser?c.currentUser.id:"",c.newquery={creation_user:c.currentUser?c.currentUser.id:"",query_text:"",conn_key:"",query_descr:""},c.newquerybypattern={creation_user:c.currentUser?c.currentUser.id:"",query_text:"",conn_key:"",query_descr:"",condition_list:[],selection_list:[],pattern_id:"",pattern_descr:""},c.queryUploader=new l({url:"/checkQueryTextFile",autoUpload:!0,removeAfterUpload:!0,queueLimit:1}),f.get("/getConnectionFull").then(function(a){c.conn_keys_respo=a.data.status},function(){}),c.queryUploader.onSuccessItem=function(a,b){c.newquery.query_text=b.status},f.post("/getPatternSummaryByUser",c.query_user).then(function(a){c.patternInfo=a.data.status},function(){}),c.setIndex=function(a){c.selectedIndex=a},c.doClearQueryText=function(){c.newquery.query_text="",c.newquery.conn_key="",c.newquery.query_descr="",c.searchText_new="",c.queryUploader.clearQueue()},c.doClearQueryTextByPattern=function(){c.newquerybypattern.query_text="",c.newquerybypattern.conn_key="",c.newquerybypattern.query_descr="",c.newquerybypattern.condition_list=[],c.newquerybypattern.selection_list=[],c.newquerybypattern.pattern_id="",c.newquerybypattern.pattern_descr="",c.searchText_descr="",c.searchText=""},c.doTestQuery=function(){var a={query_text:"",conn_key:""};if(0===c.selectedIndex){if(void 0===c.newquery.conn_key||null===c.newquery.conn_key||""===c.newquery.conn_key||""===c.newquery.conn_key.conn_key)return void c.showAlert("Please choose one connection ID");a.query_text=c.newquery.query_text,a.conn_key=c.newquery.conn_key.conn_key}else{if(void 0===c.newquerybypattern.conn_key||null===c.newquerybypattern.conn_key||""===c.newquerybypattern.conn_key.conn_key||""===c.newquerybypattern.conn_key)return void c.showAlert("Please choose one connection ID");if(0===c.newquerybypattern.selection_list.length){if(""===c.newquerybypattern.query_text)return void c.showAlert("Query is empty.");var b=[];if(angular.forEach(c.newquerybypattern.selection_list,function(a){void 0!==a.value&&b.push(a)}),0===b.length&&b.length!==c.newquerybypattern.selection_list.length)return void c.showAlert("Must have at least one selected column")}a.query_text=c.newquerybypattern.query_text,"string"==typeof c.newquerybypattern.conn_key?a.conn_key=c.newquerybypattern.conn_key:a.conn_key=c.newquerybypattern.conn_key.conn_key}""!==a.query_text&&""!==a.conn_key?f.post("/testSQLQuery",a).then(function(a){e.show(e.alert().parent(angular.element(document.querySelector("#popupContainer"))).clickOutsideToClose(!0).title("Alter Message").textContent(a.data.status.mgs).ariaLabel("Alert Dialog").ok("Got it!"))},function(){}):c.showAlert("Query is empty.")},c.doSendQuerytoPool=function(){},c.doCreateQueryTextByPattern=function(){return null===c.newquerybypattern.conn_key||""===c.newquerybypattern.conn_key?void c.showAlert("Please choose one connection ID"):null===c.newquerybypattern.query_text||""===c.newquerybypattern.query_text?void c.showAlert("Query text is empty."):void f.post("/createSQLByPattern",c.newquerybypattern).then(function(a){c.newquerybypattern.query_text=a.data.status})},c.searchTextChange=function(b){a.info("Text changed to "+b)},c.selectedConnKeyChange=function(b){a.info("Conn Key changed to "+JSON.stringify(b))},c.selectedPatternChange=function(a){void 0!==a&&(c.newquerybypattern.query_text=a.pattern_text,c.newquerybypattern.selection_list=a.selection_subArea,c.newquerybypattern.condition_list=a.condition_subArea,c.newquerybypattern.conn_key=a.connection_key,c.newquerybypattern.pattern_id=a._id,c.newquerybypattern.pattern_descr=a.pattern_descr)},c.doSetCondition=function(){var a=(i("sm")||i("xs"))&&c.customFullscreen;e.show({controller:n,templateUrl:"views/dialog.set.pattern.condition.html",parent:angular.element(document.body),clickOutsideToClose:!1,fullscreen:a,locals:{result:c.newquerybypattern},scope:c,preserveScope:!0})},c.doSetSelection=function(){var a=(i("sm")||i("xs"))&&c.customFullscreen;e.show({controller:n,templateUrl:"views/dialog.set.pattern.selection.html",parent:angular.element(document.body),clickOutsideToClose:!1,fullscreen:a,locals:{result:c.newquerybypattern},scope:c,preserveScope:!0})},n.$inject=["$scope","$mdDialog","result"],c.querySearch=function(a){var b=a?c.conn_keys_respo.filter(o(a)):c.conn_keys_respo;return b},c.querySearchByPattern=function(a){var b=a?c.patternInfo.filter(p(a)):c.patternInfo;return b},c.showAlert=function(a){e.show(e.alert().parent(angular.element(document.querySelector("#popupContainer"))).clickOutsideToClose(!0).textContent(a).ok("Got it!"))}}]).filter("searchFor",function(){return function(a,b){if(!b)return a;var c=[];return b=b.toLowerCase(),angular.forEach(a,function(a){a.pattern_descr.toLowerCase().indexOf(b)!==-1&&c.push(a)}),c}}),angular.module("ddtApp").controller("patternBuilderCtrl",["$log","$filter","$timeout","$q","$scope","$rootScope","$http","$state","$mdMedia","$mdDialog","FileUploader","AUTH_EVENTS","AuthService","IdleService",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){function o(a,b,c){a.save_result=c,a.hide=function(){b.hide()},a.cancel=function(){b.cancel()},a.answer=function(a){b.hide(a)}}function p(a,b,c,d){a.show_result=c,a.show_id=d,a.hide=function(){b.hide()},a.cancel=function(){b.cancel()},a.answer=function(a){b.hide(a)}}function q(a){var b=angular.uppercase(a);return function(a){return 0===a.conn_key.indexOf(b)}}function r(a){var b=angular.lowercase(a);return function(a){return 0===a.name.toLowerCase().indexOf(b)}}e.customFullscreen=!1,e.search={creation_user:e.currentUser?e.currentUser.id:"",start_date:"",end_date:"",conn_keys:[],pattern_selected:[]},e.edit_condition=!0,e.hideform_condition=!0,e.currentRow_condition={name:"",descr:"",row_id:""},e.edit_selection=!0,e.hideform_selection=!0,e.currentRow_selection={col_name:"",nick_name:"",row_id:""},e.newcreation={creation_user:e.currentUser?e.currentUser.id:"",pattern_text:"",pattern_type:"",conn_key:"",pattern_descr:"",user_open_list:[],extended_func_list:[],attach_list:[],condition_list:[],selection_list:[]},e.ShownPeriod="3",e.selectedConnKey=[],e.searchText="",e.showPopover=!1,e.selectedConnKey_new="",e.pattern_type=[];var s=new Date;e.maxDate=new Date(s.getFullYear(),s.getMonth(),s.getDate()+1),e.doResetInput=function(){e.newcreation.pattern_text="",e.newcreation.pattern_type="",e.newcreation.conn_key=void 0,e.newcreation.pattern_descr="",e.newcreation.user_open_list=[],e.newcreation.extended_func_list=[],e.searchText_new="",e.searchUser="",e.patternUploader.clearQueue(),e.search.start_date="",e.search.end_date="",e.search.conn_keys=[],e.search.pattern_selected=[],e.ShownPeriod="3",e.onShowPeriodChanged()},e.doClearText=function(){e.newcreation.pattern_text="",e.patternUploader.clearQueue()},e.doClearUser=function(){e.newcreation.user_open_list=[]},e.doClearAttach=function(){for(var a=0;a<e.newcreation.attach_list.length;a++){var b=e.newcreation.attach_list[a].file_id;g.post("/clearAllAttachFile",b).then(function(a){console.log("delete file:"+b+", status: "+a.data.status)},function(){})}e.newcreation.attach_list=[],e.attachmentUploader.clearQueue()},e.doAttachFiles=function(){var a=(i("sm")||i("xs"))&&e.customFullscreen;j.show({controller:o,templateUrl:"views/dialog.attach.pattern.file.html",parent:angular.element(document.body),clickOutsideToClose:!1,fullscreen:a,locals:{result:e.newcreation},scope:e,preserveScope:!0})},e.doAttachUserGroup=function(){var a=(i("sm")||i("xs"))&&e.customFullscreen;j.show({controller:o,templateUrl:"views/dialog.assign.pattern.users.html",parent:angular.element(document.body),clickOutsideToClose:!1,fullscreen:a,locals:{result:e.newcreation},scope:e,preserveScope:!0})},e.doAttachCondition=function(){var a=(i("sm")||i("xs"))&&e.customFullscreen;j.show({controller:o,templateUrl:"views/dialog.assign.pattern.condition.html",parent:angular.element(document.body),clickOutsideToClose:!1,fullscreen:a,locals:{result:e.newcreation},scope:e,preserveScope:!0})},e.doAttachSelection=function(){var a=(i("sm")||i("xs"))&&e.customFullscreen;j.show({controller:o,templateUrl:"views/dialog.assign.pattern.selection.html",parent:angular.element(document.body),clickOutsideToClose:!1,fullscreen:a,locals:{result:e.newcreation},scope:e,preserveScope:!0})},e.deletePattern=function(a){var b=j.confirm().title("Would you like to delete this pattern?").ariaLabel("Confirmation Page").ok("Yes").cancel("Cancel"),c=e.currentUser?e.currentUser.id:"",d={id:a,user:c};j.show(b).then(function(){g.post("/deletePattern",d).then(function(a){j.show(j.alert().parent(angular.element(document.querySelector("#popupContainer"))).clickOutsideToClose(!0).title("Alter Message").textContent(a.data.status.mgs).ariaLabel("Alert Dialog").ok("Got it!"))},function(){}),e.ShownPeriod="3",e.onShowPeriodChanged()},function(){})},e.testPattern=function(a){g.post("/testSQLPattern",a).then(function(a){j.show(j.alert().parent(angular.element(document.querySelector("#popupContainer"))).clickOutsideToClose(!0).title("Alter Message").textContent(a.data.status.mgs).ariaLabel("Alert Dialog").ok("Got it!"))},function(){})},e.doTestPatternDraft=function(){g.post("/testSQLPatternDraft",e.newcreation).then(function(a){j.show(j.alert().parent(angular.element(document.querySelector("#popupContainer"))).clickOutsideToClose(!0).title("Alter Message").textContent(a.data.status.mgs).ariaLabel("Alert Dialog").ok("Got it!"))},function(){})},e.editRow_condtion=function(a,b,c){e.hideform_condition=!1,"N"===a?e.edit_condition=!0:(e.edit_condition=!1,e.currentRow_condition.name=b,e.currentRow_condition.descr=c,e.currentRow_condition.row_id=a)},e.saveEdit_condition=function(a){if(a>-1){var b={name:e.currentRow_condition.name,descr:e.currentRow_condition.descr};e.newcreation.condition_list.splice(a,1),e.newcreation.condition_list.splice(a,0,b)}e.currentRow_condition.row_id="",e.currentRow_condition.name="",e.currentRow_condition.descr=""},e.saveNew_condition=function(){var a={name:e.currentRow_condition.name,descr:e.currentRow_condition.descr};e.newcreation.condition_list.push(a),e.currentRow_condition.row_id="",e.currentRow_condition.name="",e.currentRow_condition.descr=""},e.deleteRow_condition=function(a){a>-1&&e.newcreation.condition_list.splice(a,1)},e.editRow_selection=function(a,b,c){e.hideform_selection=!1,"N"===a?e.edit_selection=!0:(e.edit_selection=!1,e.currentRow_selection.col_name=b,e.currentRow_selection.nick_name=c,e.currentRow_selection.row_id=a)},e.saveEdit_selection=function(a){if(a>-1){var b={col_name:e.currentRow_selection.col_name,nick_name:e.currentRow_selection.nick_name};e.newcreation.selection_list.splice(a,1),e.newcreation.selection_list.splice(a,0,b)}e.currentRow_selection.row_id="",e.currentRow_selection.col_name="",e.currentRow_selection.nick_name=""},e.saveNew_selection=function(){var a={col_name:e.currentRow_selection.col_name,nick_name:e.currentRow_selection.nick_name};e.newcreation.selection_list.push(a),e.currentRow_selection.row_id="",e.currentRow_selection.col_name="",e.currentRow_selection.nick_name=""},e.deleteRow_selection=function(a){a>-1&&e.newcreation.selection_list.splice(a,1)},o.$inject=["$scope","$mdDialog","result"],p.$inject=["$scope","$mdDialog","result","id"],e.onlyLaterDate=function(a){var b=a;return b>=e.search.start_date},e.toggle=function(a,b){var c=b.indexOf(a);c>-1?b.splice(c,1):b.push(a)},e.exists=function(a,b){return b.indexOf(a)>-1},e.isIndeterminate=function(){return 0!==e.search.pattern_selected.length&&e.search.pattern_selected.length!==e.pattern_type.length},e.isChecked=function(){return e.search.pattern_selected.length===e.pattern_type.length},e.toggleAll=function(){e.search.pattern_selected.length===e.pattern_type.length?e.search.pattern_selected=[]:(0===e.search.pattern_selected.length||e.search.pattern_selected.length>0)&&(e.search.pattern_selected=e.pattern_type.slice(0))},e.patternUploader=new k({url:"/checkPatternTextFile",autoUpload:!0,removeAfterUpload:!0,queueLimit:1}),e.attachmentUploader=new k({url:"/checkPatternAttachedFile",queueLimit:20}),e.patternUploader.onSuccessItem=function(a,b){e.newcreation.pattern_text=b.status},e.attachmentUploader.onSuccessItem=function(a,b){if(a.formData.push({descr:b.descr,objectId:b.objectId}),b.status===!0){var c={file_name:a.file.name,file_id:b.objectId,file_size:a.file.size,description:b.descr};e.newcreation.attach_list.push(c)}},e.doRemoveItem=function(a){for(var b=0;b<e.newcreation.attach_list.length;b++){var c=e.newcreation.attach_list[b].file_id;if(a.formData[1].objectId===c){g.post("/clearAllAttachFile",c).then(function(a){console.log("delete file:"+c+", status: "+a.data.status)},function(){}),e.newcreation.attach_list.splice(b,1);break}}a.remove()},g.get("/getPatternType").then(function(a){e.pattern_type=a.data.status},function(){}),e.onShowPeriodChanged=function(){e.search.start_date="",e.search.end_date="",e.search.conn_keys=[];var a={time_range:e.ShownPeriod,start_date:e.search.start_date,end_date:e.search.end_date};g.post("/getPatternSummary",a).then(function(a){e.patternInfo=a.data.status},function(){})},e.doSearchPattern=function(){g.post("/getSearchedPatternSummary",e.search).then(function(a){e.patternInfo=a.data.status,console.log(e.patternInfo)},function(){})},e.setIndex=function(a){e.selectedIndex=a,e.onShowPeriodChanged()},e.showAlert=function(a){j.show(j.alert().parent(angular.element(document.querySelector("#popupContainer"))).clickOutsideToClose(!0).textContent(a).ok("Got it!"))},g.get("/getConnectionFull").then(function(a){e.conn_keys_respo=a.data.status},function(){}),g.get("/getSystemUser").then(function(a){e.user_respo=a.data.status},function(){}),e.doSavePattern=function(){g.post("/saveQueryPattern",e.newcreation).then(function(a){var b=a.data.status,c="Save Pattern Failed!";void 0!==b&&(c="Pattern Saved, Pattern ID : "+b),j.show(j.alert().parent(angular.element(document.querySelector("#popupContainer"))).clickOutsideToClose(!0).textContent(c).ok("Got it!"))},function(){})},e.showPatternText=function(a,b){var c=(i("sm")||i("xs"))&&e.customFullscreen;j.show({controller:p,templateUrl:"views/dialog.pattern.context.html",parent:angular.element(document.body),clickOutsideToClose:!0,fullscreen:c,locals:{result:a,id:b},scope:e,preserveScope:!0})},e.showPatternUser=function(a,b){var c=(i("sm")||i("xs"))&&e.customFullscreen;j.show({controller:p,templateUrl:"views/dialog.pattern.user.html",parent:angular.element(document.body),clickOutsideToClose:!0,fullscreen:c,locals:{result:a,id:b},scope:e,preserveScope:!0})},e.showPatternAttach=function(a,b){var c=(i("sm")||i("xs"))&&e.customFullscreen;j.show({controller:p,templateUrl:"views/dialog.pattern.attach.html",parent:angular.element(document.body),clickOutsideToClose:!0,fullscreen:c,locals:{result:a,id:b},scope:e,preserveScope:!0})},e.showPatternCondition=function(a,b){var c=(i("sm")||i("xs"))&&e.customFullscreen;j.show({controller:p,templateUrl:"views/dialog.pattern.condition.html",parent:angular.element(document.body),clickOutsideToClose:!0,fullscreen:c,locals:{result:a,id:b},scope:e,preserveScope:!0})},e.showPatternSelection=function(a,b){var c=(i("sm")||i("xs"))&&e.customFullscreen;j.show({controller:p,templateUrl:"views/dialog.pattern.selection.html",parent:angular.element(document.body),clickOutsideToClose:!0,fullscreen:c,locals:{result:a,id:b},scope:e,preserveScope:!0})},e.querySearch=function(a){var b=a?e.conn_keys_respo.filter(q(a)):e.conn_keys_respo;return b},e.querySearchUser=function(a){var b=a?e.user_respo.filter(r(a)):e.user_respo;return b},e.transformChip=function(a){if(angular.isObject(a))return a},e.searchTextChange=function(b){a.info("Text changed to "+b)},e.selectedConnKeyChange=function(b){a.info("Conn Key changed to "+JSON.stringify(b))}}]),angular.module("ddtApp").controller("queryStatusCtrl",["$scope","$rootScope","$http","$state","$mdToast","AUTH_EVENTS","AuthService","IdleService",function(a,b,c,d,e,f,g,h){}]),angular.module("ddtApp").controller("userProfileCtrl",["$scope","$rootScope","$http","$state","$mdToast","AUTH_EVENTS","AuthService","IdleService",function(a,b,c,d,e,f,g,h){}]),angular.module("ddtApp").controller("metadataImportingCtrl",["$scope","$rootScope","$http","$state","$mdToast","AUTH_EVENTS","AuthService","IdleService",function(a,b,c,d,e,f,g,h){}]),angular.module("ddtApp").controller("datasetImportingCtrl",["$scope","$http","$state","$mdDialog","$mdToast","$mdMedia","FileUploader","$window",function(a,b,c,d,e,f,g,h){function i(a,b,c){a.save_result=c,a.hide=function(){b.hide()},a.cancel=function(){b.cancel()},a.answer=function(a){b.hide(a)}}function j(a){var b=angular.lowercase(a);return function(a){return 0===a.toLowerCase().indexOf(b)}}a.customFullscreen=!1,a.showPopover=!1,a.mapped=!1,a.selectedConnItem=null,a.selectedConnKey=[],a.search={exp_user:a.currentUser?a.currentUser.id:"",start_date:"",end_date:"",conn_keys:[]},a.ShownPeriod="3",a.file_log=[],a.showFlag=!0;var k=new Date;a.maxDate=new Date(k.getFullYear(),k.getMonth(),k.getDate()+1),a.onlyLaterDate=function(b){var c=b;return c>=a.search.start_date},a.uploader=new g({url:"/checkConnJsonFile",queueLimit:20}),a.uploader.filters.push({name:"jsonFilter",fn:function(a,b){var c=(a.name.split(".")[0],a.name.split(".")[1]);return"json"===c}}),a.uploader.onSuccessItem=function(b,c){if(b.formData.push({format:c.status.format,conn:c.status.conn,msg:c.status.error_msg,conn_key:c.status.conn_key,key_exist:c.status.key_exist}),c.status.format===!0&&c.status.conn===!0){var d={file_name:c.status.file_name,file_id:c.status.file_id,file_size:b.file.size,conn_key:c.status.conn_key,key_exist:c.status.key_exist};a.file_log.push(d)}a.save_result===c.status.conn_key&&(a.mapped=!0)},a.clearAll=function(){a.uploader.clearQueue(),a.file_log=[]},a.doResetInput=function(){a.uploader.clearQueue(),a.file_log=[],a.search.start_date="",a.search.end_date="",a.search.conn_keys=[],a.selectedConnKey=[],a.onShowPeriodChanged(),a.fulllist=[],b.get("/getConnectionShort").then(function(b){a.fulllist=b.data.status},function(){})},a.setIndex=function(b){a.selectedIndex=b,a.onShowPeriodChanged()},a.onShowPeriodChanged=function(){a.search.start_date="",a.search.end_date="",a.search.conn_keys=[];var c={time_range:a.ShownPeriod,start_date:a.search.start_date,end_date:a.search.end_date};b.post("/getConnectionSummary",c).then(function(b){a.connInfo=b.data.status},function(){})},a.doSearchDataSet=function(){a.search.conn_keys=a.selectedConnKey,b.post("/getSearchedConnectionSummary",a.search).then(function(b){a.connInfo=b.data.status},function(){})},a.doSaveDataSet=function(){1===a.selectedIndex&&b.post("/saveConnJsonFile",a.file_log).then(function(b){a.result_msg=b.data.status;var c=(f("sm")||f("xs"))&&a.customFullscreen;d.show({controller:i,templateUrl:"views/dialog.save.status.html",parent:angular.element(document.body),clickOutsideToClose:!0,fullscreen:c,locals:{result:a.result_msg},scope:a,preserveScope:!0}),a.onShowPeriodChanged(),a.uploader.clearQueue(),a.file_log=[],a.doResetInput()},function(){})},a.doUpdateDataSet=function(){b.post("/saveConnJsonFile",a.file_log).then(function(b){a.result_msg=b.data.status,a.mapped=!1,a.result_msg?(a.showAlert("Update Succeed."),a.onShowPeriodChanged()):a.showAlert("Update Failed."),a.uploader.clearQueue(),a.file_log=[]},function(){})},a.showConnDetail=function(b){var c=(f("sm")||f("xs"))&&a.customFullscreen;d.show({controller:i,templateUrl:"views/dialog.conn.info.html",parent:angular.element(document.body),clickOutsideToClose:!0,fullscreen:c,locals:{result:b},scope:a,preserveScope:!0})},i.$inject=["$scope","$mdDialog","result"],a.deleteDS=function(c){var e=d.confirm().title("Are you sure to delete the dataset connection?").ariaLabel("Confirm Dialog").ok("Confirm").cancel("Cancel");d.show(e).then(function(){b.post("/deleteConnectionKey",c).then(function(b){var c=b.data.status.message;a.onShowPeriodChanged(),a.showSimpleToast(c)},function(){}),a.doResetInput()},function(){})},a.testDS=function(c){b.post("/testConnectionKey",c).then(function(b){b.data.status.conn?a.showAlert("Connection test passed."):a.showAlert(b.data.status.error_msg)},function(){})},a.editDS=function(b){var c=(f("sm")||f("xs"))&&a.customFullscreen;d.show({controller:i,templateUrl:"views/dialog.update.conn.info.html",parent:angular.element(document.body),clickOutsideToClose:!1,fullscreen:c,locals:{result:b},scope:a,preserveScope:!0}),a.doResetInput()},a.showSimpleToast=function(a){e.show(e.simple().content(a).position("bottom right").hideDelay(1e3))},a.showAlert=function(a){d.show(d.alert().parent(angular.element(document.querySelector("#popupContainer"))).clickOutsideToClose(!0).textContent(a).ok("Got it!"))},b.get("/getConnectionShort").then(function(b){a.fulllist=b.data.status},function(){}),a.transformChip=function(a){if(angular.isObject(a))return a},a.querySearch=function(b){var c=b?a.fulllist.filter(j(b)):[];return c}}]),angular.module("ddtApp").controller("helpCtrl",["$scope","$rootScope","$http","$state","$mdToast","$mdDialog","AUTH_EVENTS","AuthService","IdleService",function(a,b,c,d,e,f,g,h,i){a.doClearDoc=function(){c.post("/clearAllDoc").then(function(a){var b="Deleted file number: "+a.data.status.length;console.log("delete file id: "+a.data.status),f.show(f.alert().parent(angular.element(document.querySelector("#popupContainer"))).clickOutsideToClose(!0).textContent(b).ok("Got it!"))},function(){})}}]),angular.module("ddtApp").run(["$templateCache",function(a){a.put("views/dataset_importing.html",'<style>.my-drop-zone { border: dotted 3px lightgray; }\n    .nv-file-over { border: dotted 3px red; } /* Default class applied to drop zones on over */\n    .another-file-over-class { border: dotted 3px green; }\n    html, body { height: 100%; }\n    table, th , td {\n        border-collapse: collapse;\n        padding: 5px;\n    }\n\n    table tr:nth-child(odd) {\n        background-color: #f2f2f2;\n    }\n\n    table tr:nth-child(even) {\n        background-color: #ffffff;\n    }\n\n    a {\n    position: relative;\n    }\n\n    .popover {\n        text-decoration: none;\n        color: LightGray;\n        position: absolute;\n        left: 100%;\n        top: 0;\n        display: block;;\n        padding: 0 120px;\n    }\n\n    .popover span {\n        display: block;\n        font-weight: 200;\n    }</style> <br> <div layout="row"> <div flex="5"></div> <form flex="90" layout="row"> <span class="md-headline">Dataset Import</span> <span flex></span> <md-button class="md-primary md-raised" ng-click="doSearchDataSet()">Search</md-button> <md-button class="md-primary md-raised" ng-click="doSaveDataSet()">Save</md-button> <div layout="row" layout-align="end center"> <span flex></span> <md-button ng-click="doResetInput()">Reset</md-button> </div> </form> </div> <div layout="column" ng-cloak=""> <md-contentclas s="md-padding" layout="row"> <div flex="5"></div> <form flex="90"> <md-tabs md-dynamic-height md-border-bottom> <md-tab md-on-select="setIndex(0)" label="Dataset Overview"> <md-card> <md-card-content layout="column"> <div class="md-actions" layout="row" layout-align="left center"> <md-datepicker ng-model="search.start_date" md-max-date="maxDate" md-placeholder="Enter Start date"></md-datepicker> <md-datepicker ng-model="search.end_date" md-date-filter="onlyLaterDate" md-max-date="maxDate" md-placeholder="Enter End date"></md-datepicker> <span flex></span> <md-chips ng-model="selectedConnKey" md-autocomplete-snap="" md-transform-chip="transformChip($chip)" md-require-match="true"> <md-autocomplete md-selected-item="selectedItem" md-search-text="searchText" md-items="item in querySearch(searchText)" md-item-text="item" placeholder="Search for connection key"> <span md-highlight-text="searchText">{{item}}</span> </md-autocomplete> <md-chip-template> <span> <strong>{{$chip}}</strong> </span> </md-chip-template> </md-chips> </div> <div layout="column" flex> <md-card> <md-card-title> <md-card-title-text layout="row"> <div flex="80" layout="row" layout-align="center center"> <h5><strong>Current Dataset Overview</strong></h5><div ng-show="workFileInfo.length"><h5><strong>({{workFileInfo.length}})</strong></h5></div> </div> <div flex="20" layout="row" layout-align="center center"> <span flex></span> Shown Period: <select ng-model="ShownPeriod" ng-change="onShowPeriodChanged()" ng-init="onShowPeriodChanged()"> <option value="3">Last 3 Months</option> <option value="6">Last 6 Months</option> <option value="1">Last 1 Year</option> <option value="A">All</option> </select> </div> </md-card-title-text> </md-card-title> <md-card-content> <md-content flex layout-padding style="height: 500px"> <table class="table table-hover"> <tr> <th>Connection ID</th> <th>Description</th> <th>Version</th> <th>Update Date</th> <th>File Name</th> <th>Detail</th> <th>Action</th> </tr> <tr ng-repeat="conn in connInfo"> <td>{{conn.conn_key}}</td> <td>{{conn.desc | limitTo:20}} <a ng-mouseover="showPopover=true;" ng-mouseleave="showPopover=false;">...<div data-toggle="tooltip" ng-show="showPopover">{{conn.desc}}</div></a></td> <td>{{conn.version}}</td> <td>{{conn.updated_date}}</td> <td>{{conn.file_name}}</td> <td><a href="" ng-click="showConnDetail(conn.detail)">Click</a></td> <td nowrap> <button class="btn" ng-click="editDS(conn.conn_key)"> <span class="glyphicon glyphicon-pencil"></span>&nbsp;&nbsp;Edit </button> <button class="btn" ng-click="deleteDS(conn.conn_key)"> <span class="glyphicon glyphicon-remove"></span>&nbsp;&nbsp;Delete </button> <button class="btn" ng-click="testDS(conn.conn_key)"> <span class="glyphicon glyphicon-play-circle"></span>&nbsp;&nbsp;Test </button> </td> </tr> </table> </md-content> </md-card-content> </md-card> </div> </md-card-content> </md-card> </md-tab> <md-tab md-on-select="setIndex(1)" label="JSON Upload"> <div layout="row"> <md-card flex="20"> <md-card-content layout="column"> <h3>Select files</h3> (Only JSON files are accepted) <div> </div> <br> <div ng-show="uploader.isHTML5"> <div nv-file-drop="" uploader="uploader"> <div class="well my-drop-zone" nv-file-over="" uploader="uploader" filters="jsonFilter"> Files drop zone </div> </div> </div> <br> <div class="col-md-3" flex> Multiple <input type="file" nv-file-select="" filters="jsonFilter" uploader="uploader" multiple><br> </div> </md-card-content> </md-card> <md-card flex="70"> <md-card-content layout="row"> <div class="col-md-9" style="margin-bottom: 40px"> <h3>Upload queue</h3> <p>Queue length: {{ uploader.queue.length }}</p> <table class="table"> <thead> <tr> <th width="50%">Name</th> <th ng-show="uploader.isHTML5">Size</th> <th ng-show="uploader.isHTML5">Progress</th> <th>Status</th> <th>Actions</th> <th>Attributes</th> </tr> </thead> <tbody> <tr ng-repeat="item in uploader.queue"> <td><strong>{{ item.file.name }}</strong></td> <td ng-show="uploader.isHTML5" nowrap>{{ item.file.size/1024|number:2 }} B</td> <td ng-show="uploader.isHTML5"> <div class="progress" style="margin-bottom: 0"> <div class="progress-bar" role="progressbar" ng-style="{ \'width\': item.progress + \'%\' }"></div> </div> </td> <td class="text-center" nowrap> Check <span ng-show="item.isSuccess"><i class="glyphicon glyphicon-ok"></i></span> <span ng-show="item.isError"><i class="glyphicon glyphicon-remove"></i></span> | Format <span ng-show="item.formData[0].format"><i class="glyphicon glyphicon-ok"></i></span> <span ng-show="item.formData[1].format==false"><i class="glyphicon glyphicon-remove"></i></span> | Conn <span ng-show="item.formData[0].conn"><i class="glyphicon glyphicon-ok"></i></span> <span ng-show="item.formData[0].conn==false"><a ng-mouseover="showPopover=true;" ng-mouseleave="showPopover=false;"><i class="glyphicon glyphicon-info-sign"></i><div class="popover" ng-show="showPopover"><span>{{item.formData[0].msg}}</span></div></a></span> | Exist <span ng-show="item.formData[0].key_exist"><i class="glyphicon glyphicon-ok"></i></span> <span ng-show="item.formData[0].key_exist==false"><i class="glyphicon glyphicon-remove"></i></span> </td> <td nowrap> <button type="button" class="btn btn-danger btn-xs" ng-click="item.remove()"> <span class="glyphicon glyphicon-trash"></span> Remove </button> </td> <td nowrap> <label ng-show="item.formData[0].conn_key">Connection ID: </label> {{item.formData[0].conn_key}} </td> </tr> </tbody> </table> <div> <div> Queue progress: <div class="progress" style=""> <div class="progress-bar" role="progressbar" ng-style="{ \'width\': uploader.progress + \'%\' }"></div> </div> </div> <button type="button" class="btn btn-success btn-s" ng-click="uploader.uploadAll()" ng-disabled="!uploader.getNotUploadedItems().length"> <span class="glyphicon glyphicon-play-circle"></span> Check all </button> <button type="button" class="btn btn-danger btn-s" ng-click="clearAll()" ng-disabled="!uploader.queue.length"> <span class="glyphicon glyphicon-trash"></span> Remove all </button> </div> </div> </md-card-content> </md-card> </div> </md-tab> </md-tabs> </form> <div flex="5"></div>  </md-contentclas></div>'),
a.put("views/dialog.assign.pattern.condition.html",'<md-dialog aria-label="Query Pattern Condition Assignment" flex="45"> <md-toolbar> <div class="md-toolbar-tools"> <h2>Assign Condition to Query Pattern: <code>{{newcreation.pattern_descr}}</code></h2> <span flex></span> <md-button class="md-icon-button" ng-click="cancel()"> <md-icon md-svg-src="images/icon/close.30972319.svg" aria-label="Close dialog"></md-icon> </md-button> </div> </md-toolbar> <md-dialog-content> <div layout="row" flex> <div> <md-card> <md-card-title> <br> <button class="btn btn-success" ng-click="editRow_condtion(\'N\', \'\', \'\')"> <span class="glyphicon glyphicon-user"></span> Create New Condition </button> </md-card-title> <md-card-content> <div ng-hide="hideform_condition" flex> <h4 ng-show="edit_condition">Create New Condition:</h4> <h4 ng-hide="edit_condition">Edit Condition:</h4> <md-input-container> <label>Condition SubArea:</label> <input ng-model="currentRow_condition.name"> </md-input-container> <md-input-container> <label>Description:</label> <input ng-model="currentRow_condition.descr"> </md-input-container> <hr> <button class="btn btn-success" ng-click="saveNew_condition()" ng-show="edit_condition"> <span class="glyphicon glyphicon-save"></span> Add Condition </button> <button class="btn btn-success" ng-click="saveEdit_condition(currentRow_condition.row_id)" ng-hide="edit_condition"> <span class="glyphicon glyphicon-save"></span> Save change </button> </div> </md-card-content> </md-card> </div> <div></div> <div> <md-card> <md-card-title layout="row" layout-align="center center"> <h5><strong>Condition List </strong></h5><div ng-show="newcreation.condition_list.length"><h5><strong>({{newcreation.condition_list.length}})</strong></h5></div> </md-card-title> <md-card-content> <md-content flex layout-padding style="height: 500px"> <span flex> <table class="table table-striped"> <thead> <tr> <th>Condition</th> <th>Description</th> <th>Edit</th> <th>Delete</th> </tr> </thead> <tbody> <tr ng-repeat="row in newcreation.condition_list"> <td>{{row.name}}</td> <td>{{row.descr}}</td> <td> <button class="btn" ng-click="editRow_condtion($index,row.name,row.descr)"> <span class="glyphicon glyphicon-pencil"></span>&nbsp;&nbsp;Edit </button> </td> <td> <button class="btn" ng-click="deleteRow_condition($index)"> <span class="glyphicon glyphicon-pencil"></span>&nbsp;&nbsp;Delete </button> </td> </tr> </tbody> </table> <span> </span></span></md-content> </md-card-content> </md-card> </div> </div> </md-dialog-content> </md-dialog>'),a.put("views/dialog.assign.pattern.selection.html",'<md-dialog aria-label="Query Pattern Selection Assignment" flex="45"> <md-toolbar> <div class="md-toolbar-tools"> <h2>Assign Selection to Query Pattern: <code>{{newcreation.pattern_descr}}</code></h2> <span flex></span> <md-button class="md-icon-button" ng-click="cancel()"> <md-icon md-svg-src="images/icon/close.30972319.svg" aria-label="Close dialog"></md-icon> </md-button> </div> </md-toolbar> <md-dialog-content> <div layout="row" flex> <div> <md-card> <md-card-title> <br> <button class="btn btn-success" ng-click="editRow_selection(\'N\', \'\', \'\')"> <span class="glyphicon glyphicon-user"></span> Create New Selection </button> </md-card-title> <md-card-content> <div ng-hide="hideform_selection" flex> <h4 ng-show="edit_selection">Create New Selection:</h4> <h4 ng-hide="edit_selection">Edit Selection:</h4> <md-input-container> <label>Selection SubArea:</label> <input ng-model="currentRow_selection.col_name"> </md-input-container> <md-input-container> <label>Alias Name:</label> <input ng-model="currentRow_selection.nick_name"> </md-input-container> <hr> <button class="btn btn-success" ng-click="saveNew_selection()" ng-show="edit_selection"> <span class="glyphicon glyphicon-save"></span> Add Selection </button> <button class="btn btn-success" ng-click="saveEdit_selection(currentRow_selection.row_id)" ng-hide="edit_selection"> <span class="glyphicon glyphicon-save"></span> Save change </button> </div> </md-card-content> </md-card> </div> <div></div> <div> <md-card> <md-card-title layout="row" layout-align="center center"> <h5><strong>Selection List </strong></h5><div ng-show="newcreation.selection_list.length"><h5><strong>({{newcreation.selection_list.length}})</strong></h5></div> </md-card-title> <md-card-content> <md-content flex layout-padding style="height: 500px"> <span flex> <table class="table table-striped"> <thead> <tr> <th>Selection Name</th> <th>Alias Name</th> <th>Edit</th> <th>Delete</th> </tr> </thead> <tbody> <tr ng-repeat="row in newcreation.selection_list"> <td>{{row.col_name}}</td> <td>{{row.nick_name}}</td> <td> <button class="btn" ng-click="editRow_selection($index,row.col_name,row.nick_name)"> <span class="glyphicon glyphicon-pencil"></span>&nbsp;&nbsp;Edit </button> </td> <td> <button class="btn" ng-click="deleteRow_selection($index)"> <span class="glyphicon glyphicon-pencil"></span>&nbsp;&nbsp;Delete </button> </td> </tr> </tbody> </table> <span> </span></span></md-content> </md-card-content> </md-card> </div> </div> </md-dialog-content> </md-dialog>'),a.put("views/dialog.assign.pattern.users.html",'<md-dialog aria-label="Query Pattern User Assignment" flex="45"> <md-toolbar> <div class="md-toolbar-tools"> <h2>Assign Users to Query Pattern: <code>{{newcreation.pattern_descr}}</code></h2> <span flex></span> <md-button class="md-icon-button" ng-click="cancel()"> <md-icon md-svg-src="images/icon/close.30972319.svg" aria-label="Close dialog"></md-icon> </md-button> </div> </md-toolbar> <md-dialog-content> <!-- <md-autocomplete id="userAc"\n                         md-selected-item="save_result.user_open_list"\n                         md-search-text="searchUser"\n                         md-selected-item-change="selectedUserChange(item)"\n                         md-items="item in querySearchUser(searchUser)"\n                         md-item-text="item.name"\n                         md-min-length="0"\n                         md-no-cache="true"\n                         placeholder="Add User or Group...">\n          <md-item-template>\n            <span md-highlight-text="searchUser" md-highlight-flags="^i">{{item.name}}  ({{item.type}})</span>\n          </md-item-template>\n          <md-not-found>\n            No contact matching "{{searchUser}}" was found.\n          </md-not-found>\n        </md-autocomplete> --> <md-chips ng-model="newcreation.user_open_list" md-autocomplete-snap="" md-transform-chip="transformChip($chip.name)" md-require-match="true"> <md-autocomplete md-selected-item="selectedItem" md-search-text="searchUser" md-items="item in querySearchUser(searchUser)" md-item-text="item.name" placeholder="Search for User/Group."> <span md-highlight-text="searchUser">{{item.name}} :: {{item.type}}</span> </md-autocomplete> <md-chip-template> <span> <strong>{{$chip.name}}</strong> </span> </md-chip-template> </md-chips> <h4>Currently Selected User or Group</h4> <md-card> <md-card-content> <p ng-repeat="user in newcreation.user_open_list">{{user.name}} ({{user.type}})</p> </md-card-content> </md-card> <div> <md-button class="md-primary md-hue-1" ng-click="doClearUser()">Clear</md-button> </div> </md-dialog-content> </md-dialog>'),a.put("views/dialog.attach.pattern.file.html",'<md-dialog aria-label="Query Pattern Attachments"> <md-toolbar> <div class="md-toolbar-tools"> <h2>Attach Files to Query Pattern: <code>{{save_result.pattern_descr}}</code></h2> <span flex></span> <md-button class="md-icon-button" ng-click="cancel()"> <md-icon md-svg-src="images/icon/close.30972319.svg" aria-label="Close dialog"></md-icon> </md-button> </div> </md-toolbar> <md-dialog-content> <div class="md-dialog-content" layout="row"> <md-card flex="20"> <md-card-content layout="column"> <h3>Select file</h3> <div> </div> <br> <div ng-show="attachmentUploader.isHTML5"> <div nv-file-drop="" uploader="attachmentUploader"> <div class="well my-drop-zone" nv-file-over="" uploader="attachmentUploader"> Files drop zone </div> </div> </div> <br> <div class="col-md-3" flex> Multiple <input type="file" nv-file-select="" filters="jsonFilter" uploader="attachmentUploader" multiple><br> </div> </md-card-content> </md-card> <md-card flex="70"> <md-card-content layout="row"> <div class="col-md-9" style="margin-bottom: 40px"> <h3>Upload queue</h3> <p>Queue length: {{ attachmentUploader.queue.length }}</p> <table class="table"> <thead> <tr> <th width="50%">Name</th> <th ng-show="attachmentUploader.isHTML5">Size</th> <th ng-show="attachmentUploader.isHTML5">Progress</th> <th>Status</th> <th>Description<font color="red">*</font></th> <th>Actions</th> </tr> </thead> <tbody> <tr ng-repeat="item in attachmentUploader.queue"> <td><strong>{{ item.file.name }}</strong></td> <td ng-show="attachmentUploader.isHTML5" nowrap>{{ item.file.size/1024|number:2 }} B</td> <td ng-show="attachmentUploader.isHTML5"> <div class="progress" style="margin-bottom: 0"> <div class="progress-bar" role="progressbar" ng-style="{ \'width\': item.progress + \'%\' }"></div> </div> </td> <td class="text-center" nowrap> <span ng-show="item.isSuccess"><i class="glyphicon glyphicon-ok"></i></span> <span ng-show="item.isError"><i class="glyphicon glyphicon-remove"></i></span> </td> <td> <input ng-model="item.formData[0].descr"> </td> <td nowrap> <button type="button" class="btn btn-success btn-xs" ng-click="item.upload()" ng-disabled="item.isReady || item.isUploading || item.isSuccess"> <span class="glyphicon glyphicon-upload"></span> Upload </button> <button type="button" class="btn btn-danger btn-xs" ng-click="doRemoveItem(item)"> <span class="glyphicon glyphicon-trash"></span> Remove </button> </td> </tr> </tbody> </table> <div> <div> Queue progress: <div class="progress" style=""> <div class="progress-bar" role="progressbar" ng-style="{ \'width\': attachmentUploader.progress + \'%\' }"></div> </div> </div> <button type="button" class="btn btn-success btn-s" ng-click="attachmentUploader.uploadAll()" ng-disabled="!attachmentUploader.getNotUploadedItems().length"> Upload all </button> <span flex></span> <md-button ng-click="doClearAttach()">Clear</md-button> </div> </div> </md-card-content> </md-card> </div> </md-dialog-content> </md-dialog>'),a.put("views/dialog.conn.info.html",'<md-dialog aria-label="Connection Save Status"> <md-toolbar> <div class="md-toolbar-tools"> <h2>Connection Detail</h2> <span flex></span> <md-button class="md-icon-button" ng-click="cancel()"> <md-icon md-svg-src="images/icon/close.30972319.svg" aria-label="Close dialog"></md-icon> </md-button> </div> </md-toolbar> <md-dialog-content> <div class="md-dialog-content"> <table class="table table-striped"> <thead> <tr> <th>Item Name</th> <th>Value</th> </tr> </thead> <tbody> <tr ng-repeat="(key,value) in save_result"> <td>{{key}}</td> <td>{{value}}</td> </tr> </tbody> </table> </div> </md-dialog-content> </md-dialog>'),a.put("views/dialog.pattern.attach.html",'<md-dialog aria-label="Pattern Context"> <md-toolbar> <div class="md-toolbar-tools"> <h2>Pattern (ID = {{show_id}} ) Attachments Detail</h2> <span flex></span> <md-button class="md-icon-button" ng-click="cancel()"> <md-icon md-svg-src="images/icon/close.30972319.svg" aria-label="Close dialog"></md-icon> </md-button> </div> </md-toolbar> <md-dialog-content> <div class="md-dialog-content"> <table class="table table-striped"> <thead> <tr> <th>File Name</th> <th>Description</th> <th>Upload Time</th> <th>File ID</th> <th>File Size</th> </tr> </thead> <tbody> <tr ng-repeat="item in show_result"> <td>{{item.file_name}}</td> <td>{{item.description | limitTo:20}} <a ng-mouseover="showPopover=true;" ng-mouseleave="showPopover=false;">...<div data-toggle="tooltip" ng-show="showPopover">{{item.description}}</div></a></td> <td>{{item.upload_time}}</td> <td>{{item.file_id}}</td> <td>{{item.file_size}}</td> </tr> </tbody> </table> </div> </md-dialog-content> </md-dialog>'),a.put("views/dialog.pattern.condition.html",'<md-dialog aria-label="Pattern Context"> <md-toolbar> <div class="md-toolbar-tools"> <h2>Pattern (ID = {{show_id}} ) Conditions Detail</h2> <span flex></span> <md-button class="md-icon-button" ng-click="cancel()"> <md-icon md-svg-src="images/icon/close.30972319.svg" aria-label="Close dialog"></md-icon> </md-button> </div> </md-toolbar> <md-dialog-content> <div class="md-dialog-content"> <table class="table table-striped"> <thead> <tr> <th>Condition</th> <th>Description</th> </tr> </thead> <tbody> <tr ng-repeat="item in show_result"> <td>{{item.name}}</td> <td>{{item.descr}}</td> </tr> </tbody> </table> </div> </md-dialog-content> </md-dialog>'),a.put("views/dialog.pattern.context.html",'<md-dialog aria-label="Pattern Context"> <md-toolbar> <div class="md-toolbar-tools"> <h2>Pattern (ID = {{show_id}} ) Context Detail</h2> <span flex></span> <md-button class="md-icon-button" ng-click="cancel()"> <md-icon md-svg-src="images/icon/close.30972319.svg" aria-label="Close dialog"></md-icon> </md-button> </div> </md-toolbar> <md-dialog-content> <md-card-content layout="column"> Pattern Text: <textarea ng-model="show_result" style="height:250px; overflow:scroll"></textarea> </md-card-content> </md-dialog-content> </md-dialog>'),a.put("views/dialog.pattern.selection.html",'<md-dialog aria-label="Pattern Context"> <md-toolbar> <div class="md-toolbar-tools"> <h2>Pattern (ID = {{show_id}} ) Selections Detail</h2> <span flex></span> <md-button class="md-icon-button" ng-click="cancel()"> <md-icon md-svg-src="images/icon/close.30972319.svg" aria-label="Close dialog"></md-icon> </md-button> </div> </md-toolbar> <md-dialog-content> <div class="md-dialog-content"> <table class="table table-striped"> <thead> <tr> <th>Selection Name</th> <th>Alias Name</th> </tr> </thead> <tbody> <tr ng-repeat="item in show_result"> <td>{{item.col_name}}</td> <td>{{item.nick_name}}</td> </tr> </tbody> </table> </div> </md-dialog-content> </md-dialog>'),a.put("views/dialog.pattern.user.html",'<md-dialog aria-label="Pattern Context"> <md-toolbar> <div class="md-toolbar-tools"> <h2>Pattern (ID = {{show_id}} ) Users Detail</h2> <span flex></span> <md-button class="md-icon-button" ng-click="cancel()"> <md-icon md-svg-src="images/icon/close.30972319.svg" aria-label="Close dialog"></md-icon> </md-button> </div> </md-toolbar> <md-dialog-content> <div class="md-dialog-content"> <table class="table table-striped"> <thead> <tr> <th>User Name</th> <th>User Type</th> </tr> </thead> <tbody> <tr ng-repeat="item in show_result"> <td>{{item.name}}</td> <td>{{item.type}}</td> </tr> </tbody> </table> </div> </md-dialog-content> </md-dialog>'),a.put("views/dialog.save.status.html",'<md-dialog aria-label="Connection Save Status"> <md-toolbar> <div class="md-toolbar-tools"> <h2>Connection Save Status</h2> <span flex></span> <md-button class="md-icon-button" ng-click="cancel()"> <md-icon md-svg-src="images/icon/close.30972319.svg" aria-label="Close dialog"></md-icon> </md-button> </div> </md-toolbar> <md-dialog-content> <div class="md-dialog-content"> <h2>Totally, there is {{result_msg.length}} connection(s) to be saved.</h2> <table class="table table-striped"> <thead> <tr> <th>Connection ID</th> <th>Save Status</th> <th>Comments</th> </tr> </thead> <tbody> <tr ng-repeat="result in save_result"> <td>{{result.conn_key}}</td> <td ng-show="result.status">OK</td> <td ng-show="!result.status">FAILED</td> <td>{{result.message}}</td> </tr> </tbody> </table> </div> </md-dialog-content> </md-dialog>'),a.put("views/dialog.set.pattern.condition.html",'<md-dialog aria-label="Query Pattern Condition Setup" flex="45"> <md-toolbar> <div class="md-toolbar-tools"> <h2>Setup Condition to Query Pattern: <code>{{newquerybypattern.pattern_descr}}</code></h2> <span flex></span> <md-button class="md-icon-button" ng-click="cancel()"> <md-icon md-svg-src="images/icon/close.30972319.svg" aria-label="Close dialog"></md-icon> </md-button> </div> </md-toolbar> <md-dialog-content> <div layout="row" flex> <md-card> <md-card-title layout="row" layout-align="center center"> <h5><strong>Condition List </strong></h5><div ng-show="newquerybypattern.condition_list.length"><h5><strong>({{newquerybypattern.condition_list.length}})</strong></h5></div> </md-card-title> <md-card-content> <md-content flex layout-padding style="height: 500px"> <span flex> <table class="table table-striped"> <thead> <tr> <th>Condition</th> <th>Description</th> <th>Value</th> </tr> </thead> <tbody> <tr ng-repeat="row in newquerybypattern.condition_list"> <td>{{row.name}}</td> <td>{{row.descr}}</td> <td> <input required name="value" ng-model="row.value"> </td> </tr> </tbody> </table> <span> </span></span></md-content> </md-card-content> </md-card> </div> </md-dialog-content> </md-dialog>'),a.put("views/dialog.set.pattern.selection.html",'<md-dialog aria-label="Query Pattern Selection Setup" flex="45"> <md-toolbar> <div class="md-toolbar-tools"> <h2>Setup Condition to Query Pattern: <code>{{newquerybypattern.pattern_descr}}</code></h2> <span flex></span> <md-button class="md-icon-button" ng-click="cancel()"> <md-icon md-svg-src="images/icon/close.30972319.svg" aria-label="Close dialog"></md-icon> </md-button> </div> </md-toolbar> <md-dialog-content> <div layout="row" flex> <md-card> <md-card-title layout="row" layout-align="center center"> <h5><strong>Selection List </strong></h5><div ng-show="newquerybypattern.selection_list.length"><h5><strong>({{newquerybypattern.selection_list.length}})</strong></h5></div> </md-card-title> <md-card-content> <md-content flex layout-padding style="height: 500px"> <span flex> <table class="table table-striped"> <thead> <tr> <th>Selection</th> <th>Alias Name</th> <th>Selected</th> </tr> </thead> <tbody> <tr ng-repeat="row in newquerybypattern.selection_list"> <td>{{row.col_name}}</td> <td>{{row.nick_name}}</td> <td> <md-checkbox ng-model="row.value" aria-label="Checkbox 1"> </md-checkbox> </td> </tr> </tbody> </table> <span> </span></span></md-content> </md-card-content> </md-card> </div> </md-dialog-content> </md-dialog>'),a.put("views/dialog.update.conn.info.html",'<md-dialog aria-label="Connection Save Status"> <md-toolbar> <div class="md-toolbar-tools"> <h2>Update Connection Information for Connection ID: <code>{{save_result}}</code></h2> <span flex></span> <md-button class="md-icon-button" ng-click="cancel()"> <md-icon md-svg-src="images/icon/close.30972319.svg" aria-label="Close dialog"></md-icon> </md-button> </div> </md-toolbar> <md-dialog-content> <div class="md-dialog-content" layout="row"> <md-card flex="20"> <md-card-content layout="column"> <h3>Select file</h3> (Only JSON files are accepted) <div> </div> <br> <div ng-show="uploader.isHTML5"> <div nv-file-drop="" uploader="uploader"> <div class="well my-drop-zone" nv-file-over="" uploader="uploader" filters="jsonFilter"> Files drop zone </div> </div> </div> <br> <div class="col-md-3" flex> Single <input type="file" nv-file-select="" filters="jsonFilter" uploader="uploader"><br> </div> </md-card-content> </md-card> <md-card flex="70"> <md-card-content layout="row"> <div class="col-md-9" style="margin-bottom: 40px"> <h3>Upload queue</h3> <p>Queue length: {{ uploader.queue.length }}</p> <table class="table"> <thead> <tr> <th width="50%">Name</th> <th ng-show="uploader.isHTML5">Size</th> <th ng-show="uploader.isHTML5">Progress</th> <th>Status</th> <th>Attributes</th> </tr> </thead> <tbody> <tr ng-repeat="item in uploader.queue"> <td><strong>{{ item.file.name }}</strong></td> <td ng-show="uploader.isHTML5" nowrap>{{ item.file.size/1024|number:2 }} B</td> <td ng-show="uploader.isHTML5"> <div class="progress" style="margin-bottom: 0"> <div class="progress-bar" role="progressbar" ng-style="{ \'width\': item.progress + \'%\' }"></div> </div> </td> <td class="text-center" nowrap> Check <span ng-show="item.isSuccess"><i class="glyphicon glyphicon-ok"></i></span> <span ng-show="item.isError"><i class="glyphicon glyphicon-remove"></i></span> | Format <span ng-show="item.formData[0].format"><i class="glyphicon glyphicon-ok"></i></span> <span ng-show="item.formData[1].format==false"><i class="glyphicon glyphicon-remove"></i></span> | Conn <span ng-show="item.formData[0].conn"><i class="glyphicon glyphicon-ok"></i></span> <span ng-show="item.formData[0].conn==false"><a ng-mouseover="showPopover=true;" ng-mouseleave="showPopover=false;"><i class="glyphicon glyphicon-info-sign"></i><div class="popover" ng-show="showPopover"><span>{{item.formData[0].msg}}</span></div></a></span> | Mapped <span ng-show="item.formData[0].conn_key == save_result"><i class="glyphicon glyphicon-ok"></i></span> <span ng-show="item.formData[0].conn_key !== save_result && item.formData[0].conn_key"><i class="glyphicon glyphicon-remove"></i></span> </td> <td nowrap> <label ng-show="item.formData[0].conn_key">Connection ID: </label> {{item.formData[0].conn_key}} </td> </tr> </tbody> </table> <div> <div> Queue progress: <div class="progress" style=""> <div class="progress-bar" role="progressbar" ng-style="{ \'width\': uploader.progress + \'%\' }"></div> </div> </div> <button type="button" class="btn btn-success btn-s" ng-click="uploader.uploadAll()" ng-disabled="!uploader.getNotUploadedItems().length"> <span class="glyphicon glyphicon-play-circle"></span> Check </button> <button type="button" class="btn btn-danger btn-s" ng-click="clearAll()" ng-disabled="!uploader.queue.length"> <span class="glyphicon glyphicon-trash"></span> Remove </button> <button type="button" class="btn btn-primary btn-s" ng-click="doUpdateDataSet()" ng-disabled="!uploader.queue.length || !mapped"> <span class="glyphicon glyphicon-floppy-save"></span> Save </button> </div> </div> </md-card-content> </md-card> </div> </md-dialog-content> </md-dialog>'),a.put("views/help.html",'This is help page. <md-button class="md-primary md-raised" ng-click="doClearDoc()">Clear All Doc</md-button>'),a.put("views/login.html",'<md-content layout layout-align="center center"> <div flex="25"></div> <form flex="50"> <md-card> <md-card-content layout="column" layout-align="center center"> <md-input-container> <label>User name</label> <input ng-model="credentials.username"> </md-input-container> <md-input-container> <label>Password</label> <input ng-model="credentials.password"> </md-input-container> </md-card-content> <div class="md-actions" layout="row" layout-align="center center"> <md-button ng-click="doLogin(credentials)">Login</md-button> </div> </md-card> <p class="error"><strong> {{message}}</strong> {{error}}</p> </form> <div flex="25"></div> </md-content>'),a.put("views/metadata_importing.html","This is metadata importing page."),a.put("views/pattern_builder.html",'<style>.my-drop-zone { border: dotted 3px lightgray; }\n    .nv-file-over { border: dotted 3px red; } /* Default class applied to drop zones on over */\n    .another-file-over-class { border: dotted 3px green; }\n    .checkboxdemoSyncing .checkboxDemo1 div { clear: both; }\n    .checkboxdemoSyncing legend { color: #3F51B5; }\n    .checkboxdemoSyncing legend code {  color: #3F51B5;\n                                        font-weight: normal; }\n    .checkboxdemoSyncing p { padding-left: 8px; }\n    .checkboxdemoSyncing .info { padding-left: 13px; }\n    .checkboxdemoSyncing div.standard { padding: 8px;\n                                        padding-left: 15px; }\n    .checkboxdemoSyncing fieldset.standard {  border-style: solid;\n                                              border-width: 1px;\n                                              height: 100%; }\n    .autocomplete-custom-template li {\n      border-bottom: 1px solid #ccc;\n      height: auto;\n      padding-top: 8px;\n      padding-bottom: 8px;\n      white-space: normal; }\n\n    .autocomplete-custom-template li:last-child {\n      border-bottom-width: 0; }\n\n    .autocomplete-custom-template .item-title,\n    .autocomplete-custom-template .item-metadata {\n      display: block;\n      line-height: 2; }\n\n    .autocomplete-custom-template .item-title md-icon {\n      height: 18px;\n      width: 18px; }\n\n    .checkboxdemoSyncing .checkboxDemo1 div {\n      clear: both; }\n\n    .checkboxdemoSyncing legend {\n      color: #3F51B5; }\n\n    .checkboxdemoSyncing legend code {\n      color: #3F51B5;\n      font-weight: normal; }\n\n    .checkboxdemoSyncing p {\n      padding-left: 8px; }\n\n    .checkboxdemoSyncing .info {\n      padding-left: 13px; }\n\n    .checkboxdemoSyncing div.standard {\n      padding: 8px;\n      padding-left: 15px; }\n\n    .checkboxdemoSyncing fieldset.standard {\n      border-style: solid;\n      border-width: 1px;\n      height: 100%; }\n\n    html, body { height: 100%; }\n    table, th , td {\n        border-collapse: collapse;\n        padding: 5px;\n    }\n\n    table tr:nth-child(odd) {\n        background-color: #f2f2f2;\n    }\n\n    table tr:nth-child(even) {\n        background-color: #ffffff;\n    }\n\n    a {\n    position: relative;\n    }</style> <br> <div layout="row"> <div flex="5"></div> <form flex="90" layout="row"> <span class="md-headline">Pattern Builder</span> <span flex></span> <md-button class="md-primary md-raised" ng-click="doSearchPattern()">Search</md-button> <md-button class="md-primary md-raised" ng-click="doSavePattern()">Save</md-button> <div layout="row" layout-align="end center"> <span flex></span> <md-button ng-click="doResetInput()">Reset</md-button> </div> </form> </div> <div layout="column" ng-cloak=""> <md-content class="md-padding" layout="row"> <div flex="5"></div> <form flex="90"> <md-tabs md-dynamic-height md-border-bottom> <md-tab md-on-select="setIndex(0)" label="Pattern Overview"> <md-card> <md-card-content layout="column"> <div class="md-actions" layout="column"> <div class="md-padding demo"> <div layout="row"> <div> <fieldset class="demo-fieldset"> <div layout="row"> <div> <md-checkbox aria-label="Select All" ng-checked="isChecked()" md-indeterminate="isIndeterminate()" ng-click="toggleAll()"> <span ng-if="isChecked()">Un-</span>Select All </md-checkbox> </div> <div layout="row" layout-align="space-around center" class="demo-select-all-checkboxes" ng-repeat="item in pattern_type"> <div> <md-checkbox ng-checked="exists(item, search.pattern_selected)" ng-click="toggle(item, search.pattern_selected)"> {{ item }} </md-checkbox> </div> </div> </div> </fieldset> </div> </div> </div> <div layout="row"> <md-datepicker ng-model="search.start_date" md-max-date="maxDate" md-placeholder="Enter Start date"></md-datepicker> <md-datepicker ng-model="search.end_date" md-date-filter="onlyLaterDate" md-max-date="maxDate" md-placeholder="Enter End date"></md-datepicker> <span flex></span> <md-chips ng-model="search.conn_keys" md-autocomplete-snap="" md-transform-chip="transformChip($chip.conn_key)" md-require-match="true"> <md-autocomplete md-selected-item="selectedItem" md-search-text="searchText" md-items="item in querySearch(searchText)" md-item-text="item.conn_key" placeholder="Search for connection key"> <span md-highlight-text="searchText">{{item.conn_key}}</span> </md-autocomplete> <md-chip-template> <span> <strong>{{$chip.conn_key}}</strong> </span> </md-chip-template> </md-chips> </div> </div> <div layout="column" flex> <md-card> <md-card-title> <md-card-title-text layout="row"> <div flex="80" layout="row" layout-align="center center"> <h5><strong>Current Pattern Overview</strong></h5><div ng-show="patternInfo.length"><h5><strong>({{patternInfo.length}})</strong></h5></div> </div> <div flex="20" layout="row" layout-align="center center"> <span flex></span> Shown Period: <select ng-model="ShownPeriod" ng-change="onShowPeriodChanged()" ng-init="onShowPeriodChanged()"> <option value="3">Last 3 Months</option> <option value="6">Last 6 Months</option> <option value="1">Last 1 Year</option> <option value="A">All</option> </select> </div> </md-card-title-text> </md-card-title> <md-card-content> <md-content flex layout-padding style="height: 500px"> <table class="table table-hover"> <tr> <th>ID</th> <th>Type</th> <th>Connection</th> <th>Description</th> <th>Owner</th> <th>Updated Date</th> <th>Content</th> <th>Condition</th> <th>Selection</th> <th>User List</th> <th>Attach List</th> <th>Actions</th> </tr> <tr ng-repeat="pattern in patternInfo"> <td>ID<a ng-mouseover="showPopover=true;" ng-mouseleave="showPopover=false;">...<div data-toggle="tooltip" ng-show="showPopover">{{pattern._id}}</div></a></td> <td>{{pattern.pattern_type}}</td> <td>{{pattern.connection_key}}</td> <td>{{pattern.pattern_descr | limitTo:20}} <a ng-mouseover="showPopover=true;" ng-mouseleave="showPopover=false;">...<div data-toggle="tooltip" ng-show="showPopover">{{pattern.pattern_descr}}</div></a></td> <td>{{pattern.created_user}}</td> <td>{{pattern.updated_date}}</td> <td><a href="" ng-click="showPatternText(pattern.pattern_text, pattern._id)">Click</a></td> <td><a href="" ng-click="showPatternCondition(pattern.condition_subArea, pattern._id)">{{pattern.condition_subArea.length}}</a></td> <td><a href="" ng-click="showPatternSelection(pattern.selection_subArea, pattern._id)">{{pattern.selection_subArea.length}}</a></td> <td><a href="" ng-click="showPatternUser(pattern.user_open_list, pattern._id)">{{pattern.user_open_list.length}}</a></td> <td><a href="" ng-click="showPatternAttach(pattern.attach_list, pattern._id)">{{pattern.attach_list.length}}</a></td> <td nowrap> <button class="btn" ng-click="editPattern(pattern._id)"> <span class="glyphicon glyphicon-pencil"></span>&nbsp;&nbsp;Edit </button> <button class="btn" ng-click="deletePattern(pattern._id)"> <span class="glyphicon glyphicon-remove"></span>&nbsp;&nbsp;Delete </button> <button class="btn" ng-if="pattern.pattern_type == \'SQL\'" ng-click="testPattern(pattern._id)"> <span class="glyphicon glyphicon-play-circle"></span>&nbsp;&nbsp;Test </button> </td> </tr> </table> </md-content> </md-card-content> </md-card> </div> </md-card-content> </md-card> </md-tab> <md-tab md-on-select="setIndex(1)" label="Pattern Creation"> <div layout="row"> <md-card flex="20"> <md-card-content layout="column"> <h3>Select Pattern file</h3> (text are accepted) <div> </div> <br> <div ng-show="patternUploader.isHTML5"> <div nv-file-drop="" uploader="patternUploader"> <div class="well my-drop-zone" nv-file-over="" uploader="patternUploader"> Files drop zone </div> </div> </div> <br> <div class="col-md-3" flex> Single <input type="file" nv-file-select="" uploader="patternUploader"><br> </div> </md-card-content> </md-card> <md-card flex="50"> <md-card-content layout="column"> <div layout="row"> <span flex></span> <md-button class="md-primary md-hue-1" ng-click="doClearText()">Clear</md-button> <md-button class="md-primary md-hue-1" ng-click="doTestPatternDraft()">Test</md-button> </div> Pattern Text: <textarea ng-model="newcreation.pattern_text" style="height:250px; overflow:scroll"></textarea> <br> <div layout="row"> <md-button class="md-accent" ng-click="doAttachCondition()">Condition ({{newcreation.condition_list.length}})</md-button> <md-button class="md-accent" ng-click="doAttachSelection()">Selection ({{newcreation.selection_list.length}})</md-button> <md-button class="md-accent" ng-click="doAttachUserGroup()">User ({{newcreation.user_open_list.length}})</md-button> <md-button class="md-accent" ng-click="doAttachExtension()">Extension ({{newcreation.extended_func_list.length}})</md-button> <md-button class="md-accent" ng-click="doAttachFiles()">Attach ({{newcreation.attach_list.length}})</md-button> </div> </md-card-content> </md-card> <md-card flex="20"> <md-card-content layout="column"> <div> Pattern Type: <md-radio-group ng-model="newcreation.pattern_type" class="md-primary"> <md-radio-button ng-repeat="d in pattern_type" ng-value="d" ng-class="{\'md-align-top-left\': $index==1}"> {{ d }}<br> </md-radio-button> </md-radio-group> </div> <br> <div> Connection ID: <md-autocomplete ng-disabled="false" md-no-cache="true" md-selected-item="newcreation.conn_key" md-search-text-change="searchTextChange(searchText_new)" md-search-text="searchText_new" md-selected-item-change="selectedConnKeyChange(item)" md-items="item in querySearch(searchText_new)" md-item-text="item.conn_key" md-min-length="0" placeholder="Pick an Connection ID" md-menu-class="autocomplete-custom-template"> <md-item-template> <span class="item-title"> <md-icon md-svg-icon="images/icon/octicon-repo.9d839cdc.svg"></md-icon> <!-- <a ng-mouseover="showPopover=true;" ng-mouseleave="showPopover=false;">{{item.conn_key}}<div data-toggle="tooltip" ng-show="showPopover">{{item.desc}}</div></a> --> <span>{{item.conn_key}}</span> </span> <span class="item-metadata"> <span class="item-metastat"> <p style="font-size:10px">{{item.desc}}</p> </span> </span> </md-item-template> </md-autocomplete> </div> <br> <div> Pattern Description: <md-input-container md-no-float class="md-block"> <input ng-model="newcreation.pattern_descr" placeholder="Pattern Description"> </md-input-container> </div> </md-card-content> </md-card> </div> <!-- <div layout = "row">\n            <md-card flex = "20">\n              <md-card-content layout="column">\n                  <h3>Select attachments</h3> (Only text files are accepted)\n                  <div>\n                  </div>\n                  <br/>\n                  <div ng-show="uploader.isHTML5">\n                      <div nv-file-drop="" uploader="uploader">\n                        <div class="well my-drop-zone" nv-file-over="" uploader="uploader" filters="txtFilter">\n                          Files drop zone\n                        </div>\n                      </div>\n                  </div>\n                  <br/>\n                  <div class="col-md-3" flex>\n                    Multiple\n                    <input type="file" nv-file-select="" filters="txtFilter" uploader="uploader" multiple /><br/>\n                  </div>\n              </md-card-content>\n            </md-card>\n            <md-card flex = "70">\n              <md-card-content layout = "row" >\n                <div class="col-md-9" style="margin-bottom: 40px">\n                  <h3>Upload queue</h3>\n                  <p>Queue length: {{ uploader.queue.length }}</p>\n                  <table class="table">\n                    <thead>\n                      <tr>\n                        <th width="50%">Name</th>\n                        <th ng-show="uploader.isHTML5">Size</th>\n                        <th ng-show="uploader.isHTML5">Progress</th>\n                        <th>Status</th>\n                        <th>Actions</th>\n                        <th>Attributes</th>\n                      </tr>\n                    </thead>\n                    <tbody>\n                      <tr ng-repeat="item in uploader.queue">\n                        <td><strong>{{ item.file.name }}</strong></td>\n                        <td ng-show="uploader.isHTML5" nowrap>{{ item.file.size/1024|number:2 }} B</td>\n                        <td ng-show="uploader.isHTML5">\n                          <div class="progress" style="margin-bottom: 0;">\n                            <div class="progress-bar" role="progressbar" ng-style="{ \'width\': item.progress + \'%\' }"></div>\n                          </div>\n                        </td>\n                        <td class="text-center" nowrap>\n                          Check\n                          <span ng-show="item.isSuccess"><i class="glyphicon glyphicon-ok"></i></span>\n                          <span ng-show="item.isError"><i class="glyphicon glyphicon-remove"></i></span>\n                          | Format\n                          <span ng-show="item.formData[0].format"><i class="glyphicon glyphicon-ok"></i></span>\n                          <span ng-show="item.formData[1].format==false"><i class="glyphicon glyphicon-remove"></i></span>\n                          | Conn\n                          <span ng-show="item.formData[0].conn"><i class="glyphicon glyphicon-ok"></i></span>\n                          <span ng-show="item.formData[0].conn==false"><a ng-mouseover="showPopover=true;" ng-mouseleave="showPopover=false;"><i class="glyphicon glyphicon-info-sign"></i><div class="popover" ng-show="showPopover"><span>{{item.formData[0].msg}}</span></div></a></span>\n                          | Exist\n                          <span ng-show="item.formData[0].key_exist"><i class="glyphicon glyphicon-ok"></i></span>\n                          <span ng-show="item.formData[0].key_exist==false"><i class="glyphicon glyphicon-remove"></i></span>\n\n                        </td>\n                        <td nowrap>\n                          <button type="button" class="btn btn-danger btn-xs" ng-click="item.remove()">\n                            <span class="glyphicon glyphicon-trash"></span> Remove\n                          </button>\n                        </td>\n                        <td nowrap>\n                          <label ng-show="item.formData[0].conn_key">Connection ID: </label> {{item.formData[0].conn_key}}\n                        </td>\n                      </tr>\n                    </tbody>\n                  </table>\n                  <div>\n                    <div>\n                      Queue progress:\n                      <div class="progress" style="">\n                        <div class="progress-bar" role="progressbar" ng-style="{ \'width\': uploader.progress + \'%\' }"></div>\n                      </div>\n                    </div>\n                    <button type="button" class="btn btn-success btn-s" ng-click="uploader.uploadAll()" ng-disabled="!uploader.getNotUploadedItems().length">\n                      <span class="glyphicon glyphicon-play-circle"></span> Check all\n                    </button>\n                    <button type="button" class="btn btn-danger btn-s" ng-click="clearAll()" ng-disabled="!uploader.queue.length">\n                      <span class="glyphicon glyphicon-trash"></span> Remove all\n                    </button>\n                  </div>\n                </div>\n              </md-card-content>\n            </md-card>\n          </div> --> </md-tab> </md-tabs> </form> <div flex="5"></div> </md-content> </div>'),
a.put("views/query_builder.html",'<style>.my-drop-zone { border: dotted 3px lightgray; }\n    .nv-file-over { border: dotted 3px red; } /* Default class applied to drop zones on over */\n    .another-file-over-class { border: dotted 3px green; }\n    .checkboxdemoSyncing .checkboxDemo1 div { clear: both; }\n    .checkboxdemoSyncing legend { color: #3F51B5; }\n    .checkboxdemoSyncing legend code {  color: #3F51B5;\n                                        font-weight: normal; }\n    .checkboxdemoSyncing p { padding-left: 8px; }\n    .checkboxdemoSyncing .info { padding-left: 13px; }\n    .checkboxdemoSyncing div.standard { padding: 8px;\n                                        padding-left: 15px; }\n    .checkboxdemoSyncing fieldset.standard {  border-style: solid;\n                                              border-width: 1px;\n                                              height: 100%; }\n    .autocomplete-custom-template li {\n      border-bottom: 1px solid #ccc;\n      height: auto;\n      padding-top: 8px;\n      padding-bottom: 8px;\n      white-space: normal; }\n\n    .autocomplete-custom-template li:last-child {\n      border-bottom-width: 0; }\n\n    .autocomplete-custom-template .item-title,\n    .autocomplete-custom-template .item-metadata {\n      display: block;\n      line-height: 2; }\n\n    .autocomplete-custom-template .item-title md-icon {\n      height: 18px;\n      width: 18px; }\n\n    .checkboxdemoSyncing .checkboxDemo1 div {\n      clear: both; }\n\n    .checkboxdemoSyncing legend {\n      color: #3F51B5; }\n\n    .checkboxdemoSyncing legend code {\n      color: #3F51B5;\n      font-weight: normal; }\n\n    .checkboxdemoSyncing p {\n      padding-left: 8px; }\n\n    .checkboxdemoSyncing .info {\n      padding-left: 13px; }\n\n    .checkboxdemoSyncing div.standard {\n      padding: 8px;\n      padding-left: 15px; }\n\n    .checkboxdemoSyncing fieldset.standard {\n      border-style: solid;\n      border-width: 1px;\n      height: 100%; }\n\n    html, body { height: 100%; }\n    table, th , td {\n        border-collapse: collapse;\n        padding: 5px;\n    }\n\n    table tr:nth-child(odd) {\n        background-color: #f2f2f2;\n    }\n\n    table tr:nth-child(even) {\n        background-color: #ffffff;\n    }\n\n    a {\n    position: relative;\n    }</style> <br> <div layout="row"> <div flex="5"></div> <form flex="90" layout="row"> <span class="md-headline">Query Builder</span> <span flex></span> <md-button class="md-primary md-raised" ng-click="doSendQuerytoPool()">Run</md-button> <div layout="row" layout-align="end center"> <span flex></span> <md-button ng-click="doTestQuery()">Test</md-button> </div> </form> </div> <div layout="column" ng-cloak=""> <md-content class="md-padding" layout="row"> <div flex="5"></div> <form flex="90"> <md-tabs md-dynamic-height md-border-bottom> <md-tab md-on-select="setIndex(0)" label="Adhoc Query"> <md-card> <md-card-content layout="column"> <div layout="row"> <md-card flex="20"> <md-card-content layout="column"> <h3>Select query file</h3> (text are accepted) <div> </div> <br> <div ng-show="queryUploader.isHTML5"> <div nv-file-drop="" uploader="queryUploader"> <div class="well my-drop-zone" nv-file-over="" uploader="queryUploader"> Files drop zone </div> </div> </div> <br> <div class="col-md-3" flex> Single <input type="file" nv-file-select="" uploader="queryUploader"><br> </div> </md-card-content> </md-card> <md-card flex="50"> <md-card-content layout="column"> <div layout="row"> <span flex></span> <md-button class="md-primary md-hue-1" ng-click="doClearQueryText()">Clear</md-button> </div> Query Text: <textarea ng-model="newquery.query_text" style="height:250px; overflow:scroll"></textarea> <br> Meta-Data Overview </md-card-content> </md-card> <md-card flex="20"> <md-card-content layout="column"> <div> Connection ID: <md-autocomplete ng-disabled="false" md-no-cache="true" md-selected-item="newquery.conn_key" md-search-text-change="searchTextChange(searchText_new)" md-search-text="searchText_new" md-selected-item-change="selectedConnKeyChange(item)" md-items="item in querySearch(searchText_new)" md-item-text="item.conn_key" md-min-length="0" placeholder="Pick an Connection ID" md-menu-class="autocomplete-custom-template"> <md-item-template> <span class="item-title"> <md-icon md-svg-icon="images/icon/octicon-repo.9d839cdc.svg"></md-icon> <!-- <a ng-mouseover="showPopover=true;" ng-mouseleave="showPopover=false;">{{item.conn_key}}<div data-toggle="tooltip" ng-show="showPopover">{{item.desc}}</div></a> --> <span>{{item.conn_key}}</span> </span> <span class="item-metadata"> <span class="item-metastat"> <p style="font-size:10px">{{item.desc}}</p> </span> </span> </md-item-template> </md-autocomplete> </div> <br> <div> Query Description: <md-input-container md-no-float class="md-block"> <input ng-model="newquery.query_descr" placeholder="Query Description"> </md-input-container> </div> </md-card-content> </md-card> </div> </md-card-content> </md-card> </md-tab> <md-tab md-on-select="setIndex(1)" label="Pattern Query"> <div layout="row"> <md-card flex="20"> <md-card-content layout="column"> <h3>Select One Pattern </h3> <md-autocomplete ng-disabled="false" md-no-cache="true" md-selected-item="newquerybypattern._id" md-search-text-change="searchTextChange(searchText_descr)" md-search-text="searchText_descr" md-selected-item-change="selectedPatternChange(i)" md-items="i in patternInfo | searchFor:searchText_descr" md-item-text="i.pattern_descr" md-min-length="0" placeholder="Pick an Pattern" md-menu-class="autocomplete-custom-template"> <md-item-template> <span class="item-title"> <md-icon md-svg-icon="images/icon/octicon-repo.9d839cdc.svg"></md-icon> <!-- <a ng-mouseover="showPopover=true;" ng-mouseleave="showPopover=false;">{{item.conn_key}}<div data-toggle="tooltip" ng-show="showPopover">{{item.desc}}</div></a> --> <span>{{i.pattern_descr}}</span> </span> <span class="item-metadata"> <span class="item-metastat"> <p style="font-size:10px">Owner: {{i.created_user}}</p> <p style="font-size:10px">Created: {{i.created_date}}</p> <p style="font-size:10px">Id: {{i._id}}</p> </span> </span> </md-item-template> </md-autocomplete> <br> </md-card-content> </md-card> <md-card flex="50"> <md-card-content layout="column"> <div layout="row"> <span flex></span> <md-button class="md-primary md-hue-1" ng-click="doClearQueryTextByPattern()">Clear</md-button> <md-button class="md-primary md-hue-1" ng-click="doCreateQueryTextByPattern()">Create</md-button> </div> Pattern Text: <textarea ng-model="newquerybypattern.query_text" style="height:250px; overflow:scroll"></textarea> <br> <div layout="row"> <md-button class="md-accent" ng-click="doSetCondition()">Condition ({{newquerybypattern.condition_list.length}})</md-button> <md-button class="md-accent" ng-click="doSetSelection()">Selection ({{newquerybypattern.selection_list.length}})</md-button> </div> </md-card-content> </md-card> <md-card flex="20"> <md-card-content layout="column"> <div> Connection ID: <md-autocomplete ng-disabled="false" md-no-cache="true" md-selected-item="newquerybypattern.conn_key" md-search-text-change="searchTextChange(searchText)" md-search-text="searchText" md-selected-item-change="selectedConnKeyChange(item)" md-items="item in querySearch(searchText)" md-item-text="item.conn_key" md-min-length="0" placeholder="Pick an Connection ID" md-menu-class="autocomplete-custom-template"> <md-item-template> <span class="item-title"> <md-icon md-svg-icon="images/icon/octicon-repo.9d839cdc.svg"></md-icon> <!-- <a ng-mouseover="showPopover=true;" ng-mouseleave="showPopover=false;">{{item.conn_key}}<div data-toggle="tooltip" ng-show="showPopover">{{item.desc}}</div></a> --> <span>{{item.conn_key}}</span> </span> <span class="item-metadata"> <span class="item-metastat"> <p style="font-size:10px">{{item.desc}}</p> </span> </span> </md-item-template> </md-autocomplete> </div> <br> <div> Query Description: <md-input-container md-no-float class="md-block"> <input ng-model="newquerybypattern.query_descr" placeholder="Query Description"> </md-input-container> </div> </md-card-content> </md-card> </div> </md-tab> </md-tabs> </form> <div flex="5"></div> </md-content> </div>'),a.put("views/query_status.html","This is query status page."),a.put("views/user_profile.html","This is user profile page.")}]);